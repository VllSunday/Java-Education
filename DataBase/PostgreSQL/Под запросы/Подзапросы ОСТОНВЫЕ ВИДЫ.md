---
создал заметку: 2024-08-20
---
Подзапросы в SQL — это запросы, вложенные в другие запросы. Они могут использоваться в `SELECT`, `FROM`, `WHERE`, и других частях основного запроса. Подзапросы делятся на два типа: **коррелированные подзапросы** и **некоррелированные (обычные) подзапросы**. Давайте разберемся, в чем их отличия.

### Некоррелированный (обычный) подзапрос

Некоррелированный подзапрос — это подзапрос, который выполняется один раз и результат которого используется основным запросом. Он не зависит от данных основного запроса.

#### Пример:

```sql
SELECT name
FROM employees
WHERE department_id = (
    SELECT department_id
    FROM departments
    WHERE department_name = 'HR'
);
```

В этом примере подзапрос выполняется один раз, чтобы найти `department_id` для отдела 'HR'. Затем этот результат используется основным запросом для фильтрации сотрудников, принадлежащих к этому отделу.

### Коррелированный подзапрос

Коррелированный подзапрос — это подзапрос, который зависит от данных из основного запроса. Иными словами, он выполняется заново для каждой строки основного запроса. Коррелированный подзапрос может ссылаться на столбцы из внешнего запроса.

#### Пример:

```sql
SELECT e.name
FROM employees e
WHERE e.salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
);
```

В этом примере подзапрос выполняется для каждой строки основного запроса. Он вычисляет среднюю зарплату для отдела, к которому принадлежит текущий сотрудник, и проверяет, больше ли зарплата этого сотрудника, чем средняя зарплата в его отделе. Подзапрос ссылается на `department_id` из основного запроса (`e.department_id`), поэтому он коррелированный.

### Как распознать корелированный подзапрос

- **Связь с внешним запросом:** Коррелированный подзапрос всегда ссылается на столбцы из внешнего (основного) запроса.
- **Зависимость от строки:** Коррелированный подзапрос выполняется для каждой строки основного запроса.
- **Сложность выполнения:** Коррелированные подзапросы обычно более ресурсоемкие, так как требуют многократного выполнения.

### Пример различий

#### Некоррелированный подзапрос:

```sql
SELECT name
FROM employees
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
);
```

Здесь подзапрос выполняется один раз и возвращает среднюю зарплату по всем сотрудникам, независимо от строк основного запроса.

#### Коррелированный подзапрос:

```sql
SELECT name
FROM employees e
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
);
```

Здесь подзапрос выполняется для каждой строки основного запроса, чтобы вычислить среднюю зарплату для конкретного отдела, к которому принадлежит текущий сотрудник.

### Подведем итоги:

- **Некоррелированный подзапрос**: Выполняется один раз и не зависит от основного запроса.
- **Коррелированный подзапрос**: Выполняется многократно, по одному разу для каждой строки основного запроса, и зависит от данных в основной строке.

Теперь, зная эти различия, вы сможете легко распознавать коррелированные и некоррелированные подзапросы в SQL.