---
создал заметку: 2024-08-11
---
---
## `WHERE EXISTS`

### Что такое `WHERE EXISTS`?

`WHERE EXISTS` — это конструкция в SQL, которая используется для проверки наличия записей в подзапросе. Если подзапрос возвращает хотя бы одну строку, `EXISTS` возвращает `TRUE`, и строка из основного запроса включается в результат. Если подзапрос не возвращает ни одной строки, `EXISTS` возвращает `FALSE`, и строка из основного запроса исключается.

### Синтаксис

```sql
SELECT column1, column2
FROM table1
WHERE EXISTS (
    SELECT 1
    FROM table2
    WHERE table2.column = table1.column
);
```

Этот запрос возвращает строки из `table1`, для которых существует хотя бы одна соответствующая запись в `table2`.

### Как это работает?

1. **Подзапрос**: Внутри `WHERE EXISTS` находится подзапрос, который обычно связан с основным запросом по какому-то условию (например, через колонку).
2. **Проверка наличия**: SQL-движок выполняет подзапрос для каждой строки основного запроса и проверяет, возвращает ли подзапрос хотя бы одну строку.
3. **Возвращаемое значение**: Если подзапрос возвращает хотя бы одну строку, условие `EXISTS` возвращает `TRUE`, и эта строка из основного запроса включается в результат.

### Пример использования

Допустим, у нас есть две таблицы: `suppliers` (поставщики) и `customers` (клиенты). Мы хотим найти всех поставщиков, у которых есть клиенты в той же стране:

```sql
SELECT company_name, country
FROM suppliers s
WHERE EXISTS (
    SELECT 1
    FROM customers c
    WHERE c.country = s.country
);
```

### Особенности и преимущества `WHERE EXISTS`

- **Производительность**: `EXISTS` может быть более производительным, так как SQL-движок может остановить выполнение подзапроса, как только найдет первую подходящую запись.
- **Читабельность**: `WHERE EXISTS` часто делает запрос более читабельным, особенно если задача состоит в проверке существования связанных данных.
- **Вариативность**: `WHERE EXISTS` интуитивно понятен, когда нужно проверить наличие хотя бы одной записи, соответствующей определенному условию.

### Сравнение с `IN`

- **`IN`** используется для сравнения значения с набором значений, возвращенных подзапросом.
- **`EXISTS`** используется для проверки наличия строк, удовлетворяющих условиям подзапроса.

Пример с `IN`:

```sql
SELECT company_name, country
FROM suppliers
WHERE country IN (SELECT country FROM customers);
```

Пример с `EXISTS`:

```sql
SELECT company_name, country
FROM suppliers s
WHERE EXISTS (
    SELECT 1
    FROM customers c
    WHERE c.country = s.country
);
```

### Заключение

`WHERE EXISTS` — это мощный инструмент для работы с подзапросами в SQL. Он удобен для проверки наличия связанных данных и может быть более эффективным в определенных ситуациях. Используя `WHERE EXISTS`, ты можешь создавать более читабельные и производительные запросы.

---
### 4. Когда использовать `WHERE EXISTS`

- **Используется, когда нужно проверить наличие хотя бы одной строки, которая удовлетворяет условиям.** Это часто применяется, когда нужно фильтровать строки на основе наличия связанных данных в другой таблице.
    
- **Для подсчета строк или получения дополнительных данных** используйте другие SQL-конструкции, такие как `COUNT`, `SUM`, `JOIN` и т.д. `EXISTS` не предназначен для возврата конкретных данных или их количества, а только для проверки их наличия.
    

### Пример на простом языке

1. **Основной запрос:** Возьми всех клиентов.
2. **Для каждого клиента:** Проверь, есть ли у него хотя бы один заказ с доставкой между 50 и 100.
3. **Подзапрос:** Для каждого клиента выполни поиск в таблице `orders`, чтобы узнать, есть ли у него соответствующий заказ.
4. **Включение клиента в результат:** Если хотя бы один такой заказ найден, включи клиента в результат основного запроса.

### Дополнительно

- **`EXISTS`**: Используется для проверки наличия данных. Возвращает `TRUE` или `FALSE`.
- **`IN` и агрегатные функции**: Используются для получения данных или подсчета количества строк.