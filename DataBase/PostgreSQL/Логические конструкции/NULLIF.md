---
создал заметку: 2024-08-16
---

---
# Конспект по `NULLIF` в PostgreSQL

`NULLIF` — это функция в SQL, которая позволяет возвращать `NULL`, если два значения равны. Если значения не равны, возвращается первое значение.

## 1. Основное назначение

`NULLIF` используется для предотвращения деления на ноль, для очистки значений или для управления результатами запросов, когда определенные значения не являются допустимыми.

## 2. Синтаксис

```sql
NULLIF(значение1, значение2)
```

- **значение1**: Первое значение, которое проверяется.
- **значение2**: Значение для сравнения с первым значением.

Функция возвращает `NULL`, если `значение1` равно `значение2`; в противном случае возвращает `значение1`.

## 3. Примеры использования

### Пример 1: Предотвращение деления на ноль

```sql
SELECT
    делитель,
    делимое,
    делитель / NULLIF(делимое, 0) AS результат
FROM деления;
```

В этом примере, если `делимое` равно `0`, функция `NULLIF` заменяет его на `NULL`, и деление выполняется с `NULL`, что предотвращает ошибку деления на ноль.

### Пример 2: Управление значениями по умолчанию

```sql
SELECT
    имя,
    NULLIF(дата_завершения, '0001-01-01') AS дата_завершения
FROM проекты;
```

Если `дата_завершения` равна `'0001-01-01'`, функция `NULLIF` заменяет ее на `NULL`. Это может быть полезно для очистки значений, которые представляют собой "пустые" или недопустимые даты.

### Пример 3: Сравнение значений

```sql
SELECT
    имя,
    NULLIF(зарплата, 0) AS зарплата
FROM сотрудники;
```

Если значение `зарплата` равно `0`, функция `NULLIF` заменяет его на `NULL`. Это может быть полезно для обработки случаев, когда `0` не имеет смысла как валидное значение зарплаты.

## 4. Использование с `COALESCE`

Функция `NULLIF` часто используется вместе с `COALESCE` для замены значений `NULL` на альтернативные значения. 

### Пример 1: Замена `NULL` на значение по умолчанию

```sql
SELECT
    имя,
    COALESCE(NULLIF(зарплата, 0), 50000) AS зарплата
FROM сотрудники;
```

Здесь `NULLIF` заменяет `зарплата` на `NULL`, если она равна `0`. Затем `COALESCE` заменяет этот `NULL` на `50000`.

### Пример 2: Управление делением

```sql
SELECT
    делитель,
    делимое,
    COALESCE(NULLIF(делимое, 0), 1) AS делимое_с_заменой
FROM деления;
```

В этом примере `NULLIF` предотвращает деление на ноль, заменяя `0` на `NULL`, а `COALESCE` заменяет `NULL` на `1` для выполнения деления.

## 5. Преимущества и рекомендации

- **Простота**: `NULLIF` упрощает управление значениями и предотвращает ошибки, связанные с некорректными значениями.
- **Совместимость**: Функция `NULLIF` является стандартной SQL-функцией и поддерживается большинством СУБД, что делает ее удобной для кросс-платформенной работы.
- **Использование**: Используйте `NULLIF` для очистки значений и предотвращения ошибок, а `COALESCE` для замены `NULL` значениями по умолчанию.
---