---
создал заметку: 2024-09-09
---
****
Да, давай поясню это подробнее.

### Сокет на стороне сервера

Когда ты создаёшь серверное приложение, оно начинает **слушать** входящие соединения на определённом порту (например, порт 8080). Этот сокет называется **слушающим сокетом** (или *listening socket*). 

1. **Слушающий сокет** (listening socket) открыт на определённом порту (8080). Он нужен, чтобы принимать входящие соединения. Этот сокет не участвует в непосредственной передаче данных, он только ожидает подключения клиентов.
   
2. Когда клиент подключается, сервер принимает это соединение. После этого происходит следующее: 
   - Сервер создаёт **новый сокет** для общения с этим конкретным клиентом. Этот новый сокет не слушает новые соединения, а просто занимается обменом данными между сервером и подключившимся клиентом.
   - Важно! Этот новый сокет **использует тот же порт** (8080), что и слушающий сокет, но при этом он **связан с конкретным клиентом** (по его IP и порту). То есть операционная система различает сокеты не только по порту, но и по сочетанию IP-адресов и портов обеих сторон (клиента и сервера).

### Что происходит при подключении?

1. **Слушающий сокет** (8080) на сервере ждёт, пока клиент попробует подключиться.
2. Когда клиент подключается, сервер создаёт **новый сокет** для этого клиента, но порт на сервере остаётся тем же — 8080.
3. Этот новый сокет теперь знает:
   - Локальный IP и порт сервера (например, 192.168.0.1:8080),
   - Удалённый IP и порт клиента (например, 192.168.0.100:50000).

### Ключевой момент: **Порт остаётся тем же, но у сервера появляется новый сокет** для каждого клиента.

Операционная система может различать несколько соединений на одном порту, потому что каждое соединение уникально не только по номеру порта, но и по сочетанию **IP-адреса и порта** обеих сторон (клиента и сервера).

#### Пример:

- Клиент 1 подключается с IP-адреса `192.168.0.100` и порта `50000` к серверу на порту `8080`.
- Клиент 2 подключается с IP-адреса `192.168.0.101` и порта `50001` к тому же серверу на порту `8080`.

Оба этих соединения используют порт `8080` на сервере, но операционная система различает их, потому что они приходят от разных IP-адресов и портов клиентов.

### Вывод:

- Сервер имеет **один слушающий сокет** на определённом порту (например, `8080`).
- Для каждого подключившегося клиента создаётся **новый сокет** (с тем же портом, но с уникальными IP-адресами и портами для каждого соединения).
- **Отдельный порт для каждого нового сокета не нужен**. Порт остаётся одним и тем же, а различие идёт по сочетанию IP-адресов и портов обеих сторон (клиента и сервера).

Таким образом, сервер может обрабатывать множество соединений на одном порту, используя разные сокеты для каждого клиента.