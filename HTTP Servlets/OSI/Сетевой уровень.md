---
создал заметку: 2024-09-07
---
<span style="background:#ff4d4f">Сетевой уровень</span> (network layer) - главной задачей является
разбиение сегментов с предыдущего уровня на пакеты данных
(и наоборот, пакеты собирать в сегменты для отправки на
следующий уровень), а также доставка этих пакетов данных
между разными сетями
Название основного протокола сетевого уровня - IP (Internet Protocol)
![[Pasted image 20240907203015.png]]

#### Важно подчеркнуть
Именно сетевой уровень, позволяет нам обмениваться данными между разными сетями

Если же этого не требуется, тогда используется более низкий уровень<span style="background:#ff4d4f">(канальный)</span>, для того что бы передавать нолики и единички внутри сети

### Маршрутизатор

Для передачи данных из одной сете в другую вводиться своя система адресации (сетевой адрес IPv4 или IPv6) и реализуется механизм маршрутизации (определение пути передачи данных между сетями)

Для этого нам и нужен именно маршрутизатор, а не камутатор. 

Именно маршрутизатор позволяет нам передавать наши пакеты из одной сети в другую (на сетевом уровне)
А камутатор работает на канальном уровне

### IP - адрес 
ip - Internet Protocol
IP адрес (v4) - это 32-битное число, которое принято записывать
в виде 4-ех октетов, каждое из которых разделено точкой
и занимает ровно 8 бит и может принимать значения
в диапазоне 0 - 255
Например:
192. 168.0.1
172. 217.16.4
IP адрес (v6) - это 128-битное число, которое принято
записывать в виде 8-ми четырехзначных
шестнадцатеричных чисел, разделенных двоеточием
Например:
2001:0db8:0000:0000:0000:ff00:0042:7879
2001:0db8::ff00:0042:7879


### IP пакет 
![[Pasted image 20240907210516.png]]

IP пакет состоит из данных который были переданы в него из более верхнего уровня, и заголовка (20 bytes Header)

Все эти 20 bytes разбиты на 5 частей, так называемые "слова"

Это как то связанно с тем что раньше процессорам было удобнее обрабатывать информацию по 4 байта

Давайте разберем каждое слово по отдельности:
### 1) 
1. Version - версия (IPv4, IPv6)
2. IHL (Internet Header Length) - размер заголовка (введен из-за
поля Options, которое сейчас не используется) и равен 20
байтам
3. TOS (Type Of Service) - состоит из двух полей: DSCP и ECN (не сильно используется)
4. Total Length - полный размер всего IP пакета (максимальный
размер пакета 65535 байт)
### 2 - е слово отвечает за фрагментацию

5. Identification - идентификатор пакет, который используется в
случае его фрагментации на куски (у всех кусков будет то же
значение)
Из за того что сетевой уровень передает данные в другие под-сети 
следовательно возможно ситуация когда та под-сеть может не принять пакет какого то большого размера, следственно его придется разбивать не куски более меньшего размера, следовательно ему нужно будет устанавливать какой то идентификатор, для каждой из этого куска 
6. Flags - используется для контроля над фрагментацией пакетов
(где начинается фрагментация пакета, где заканчивается и др.)
7. Fragmentation Offset - говорит на сколько байт нужно
выполнить смещение от 0 в случае фрагментации пакета

Пример: 
![[Pasted image 20240907211955.png]]

### 3)
8. TTL - время жизни пакета (чтобы не блуждал по сети до
бесконечности). Определяет максимальное число узлов, через
которое пакет может пройти перед тем, как будет уничтожен
9. Protocol - указывается протокол верхнего уровня, например,
в случае TCP - это 00000110 (6), в случае UDP - 0001 (17)
10. Header checksum - проверяет только целостность заголовка
(протокол IP не умеет проверять целостность данных,
это делают протоколы верхних уровней)

То есть что это значит? Берется весь заголовок: 20 байт и по какой то формуле генерируется число, и в случае того что этот заголовок был случайно изменен или поврежден, у нас cheacksum может не совпадать. По сути checksum просчитывается 2 раза. Сначала для маршрутизатора который передает пакет, а затем для маршрутизатора который принимает пакет

Так же важно обратить внимание что протокол IP не умеет целостность данных, по этому мы должны использовать протокол более высокого уровня, например TCP
### 4)
Sourse IP Address - IP адрес источника (нужен только принимающей стороне, чтобы знать куда слать ответ)

### 5)
Destination IP Address - IP адрес назначения(маршрутизаторы смотрят именно на это поле при принятии решения, куда направить пакет)


