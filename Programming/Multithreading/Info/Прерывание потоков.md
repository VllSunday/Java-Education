---
создал заметку: 2024-08-23
---
---
# Прерывание потоков в Java

## Введение

Прерывание потока — это механизм, который позволяет послать сигнал работающему потоку о том, что его необходимо прервать. Это не приводит к немедленной остановке потока, а лишь уведомляет его о намерении прервать выполнение. Как поступить в ответ на этот сигнал, решает сам поток.

## Основные методы для работы с прерываниями

### 1. **`interrupt()`**
- Этот метод посылает сигнал потоку о том, что его хотят прервать.
- Поток сам решает, как на это реагировать: завершить работу, сохранить состояние или игнорировать прерывание.
- Важно отметить, что вызов `interrupt()` сам по себе не завершает поток — он лишь устанавливает флаг прерывания у потока.

### 2. **`isInterrupted()`**
- Этот метод позволяет потоку (или другим потокам) проверить, был ли установлен флаг прерывания для текущего потока.
- Возвращает `true`, если поток был прерван, и `false` в противном случае.
- Метод не сбрасывает флаг прерывания.

### 3. **`Thread.interrupted()`**
- Этот статический метод проверяет, был ли текущий поток прерван.
- Возвращает `true`, если поток был прерван, и `false` в противном случае.
- В отличие от `isInterrupted()`, `Thread.interrupted()` сбрасывает флаг прерывания после проверки, что позволяет другим частям кода снова проверять прерывание.

## Как работает прерывание?

Прерывание потока — это способ взаимодействия между потоками, позволяющий одному потоку уведомить другой о необходимости завершить выполнение или изменить поведение. Важно понимать, что прерывание не завершает поток автоматически.

Прерывание потока может быть реализовано двумя способами:

1. **Поток находится в ожидающем состоянии (например, `sleep()`, `wait()`, `join()`):**
   - Если поток ожидает завершения, вызов `interrupt()` приводит к выбросу исключения `InterruptedException`.
   - Исключение сигнализирует о том, что поток был прерван, и поток может либо обработать это исключение, либо выйти из выполнения.

2. **Поток находится в активном состоянии:**
   - В этом случае вызов `interrupt()` просто устанавливает флаг прерывания для потока.
   - Поток должен самостоятельно проверять этот флаг с помощью `isInterrupted()` или `Thread.interrupted()` и принимать соответствующие меры.

## Обработка прерывания

### Пример с использованием `sleep()`:

```java
public class InterruptExample {
    public static void main(String[] args) {
        Thread thread = new Thread(() -> {
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                System.out.println("Поток был прерван во время сна");
            }
        });

        thread.start();
        thread.interrupt(); // Посылаем сигнал прерывания
    }
}
```
В этом примере поток засыпает на 5 секунд. Однако сразу после запуска мы прерываем поток, вызывая `interrupt()`. Это приводит к выбросу исключения `InterruptedException`, которое можно обработать и, например, завершить выполнение потока.

### Пример с проверкой флага прерывания:

```java
public class InterruptFlagExample {
    public static void main(String[] args) {
        Thread thread = new Thread(() -> {
            while (!Thread.currentThread().isInterrupted()) {
                System.out.println("Поток работает...");
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    System.out.println("Поток был прерван во время сна");
                    Thread.currentThread().interrupt(); // Снова устанавливаем флаг прерывания
                }
            }
            System.out.println("Поток завершил работу.");
        });

        thread.start();
        try {
            Thread.sleep(3000); // Даем потоку поработать 3 секунды
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        thread.interrupt(); // Прерываем поток
    }
}
```
В этом примере поток выполняет работу в цикле, проверяя флаг прерывания с помощью `isInterrupted()`. Если поток прерывается во время сна, выбрасывается исключение `InterruptedException`, после чего флаг прерывания снова устанавливается вручную. Когда поток видит, что его прервали, он завершает свою работу.

## Исключение `InterruptedException`

**`InterruptedException`** — это проверяемое исключение, которое выбрасывается в том случае, если поток был прерван во время выполнения методов, которые могут вызвать блокировку (например, `Thread.sleep()`, `Object.wait()`, `Thread.join()`).

- Обработка этого исключения является обязательной, так как это сигнал того, что поток был прерван.
- Поток может решить, как реагировать на это исключение: завершить выполнение, повторить попытку или игнорировать его.

### Пример обработки `InterruptedException`:

```java
public class InterruptedExample {
    public static void main(String[] args) {
        Thread thread = new Thread(() -> {
            try {
                for (int i = 0; i < 5; i++) {
                    System.out.println("Работаем... " + i);
                    Thread.sleep(1000);
                }
            } catch (InterruptedException e) {
                System.out.println("Поток был прерван!");
            }
        });

        thread.start();

        try {
            Thread.sleep(2000); // Даем потоку поработать 2 секунды
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        thread.interrupt(); // Прерываем поток
    }
}
```
В этом примере поток работает в цикле, выполняя работу и прерывается после 2 секунд, что вызывает выброс исключения `InterruptedException`.

## Заключение

Прерывание потоков — это мощный механизм управления многопоточными приложениями. Важно понимать, что прерывание не приводит к мгновенной остановке потока, а лишь посылает сигнал о необходимости прерывания. Поток сам решает, как реагировать на это событие. Использование методов `interrupt()`, `isInterrupted()`, и обработка исключения `InterruptedException` позволяют гибко управлять поведением потоков и контролировать их выполнение.