---
создал заметку: 2024-08-24
---
До этого мы рассматривали много cuncurrency примеров, где cuncarrency был low level.
Low level означает что мы сами делали Lock-и, синхронизацию и тд. 

Теперь мы рассмотрим несколько high level cuncurrency примеров, где мы сами не будем писать не локи, не синхронизации, а будем пользоваться готовыми решениями. Которые в свою очередь используют low level cuncurrency механизмы. 

Такие готовые решения называются ==Synchronizers==

# Semaphore
![[Semaphore.gif]]
### Что такое семафор?

Семафор — это специальная сущность (да, можно называть его синхронизатором или механизмом синхронизации), которая используется для управления доступом к общим ресурсам в многопоточных программах. Он не создает потоки, не связан напрямую с потоками, но активно используется для управления их поведением.

### Как работает семафор?

- **Разрешения**: Семафор управляет доступом к ресурсу с помощью так называемых "разрешений" (`permits`). В момент создания семафора ты указываешь количество этих разрешений. Например, если семафор создан с 5 разрешениями, это означает, что одновременно к ресурсу могут получить доступ до 5 потоков.
    
- **Запрос разрешения (`acquire()`)**: Когда поток вызывает метод `acquire()`, он запрашивает разрешение у семафора. Если разрешение доступно (т.е. значение `counter` внутри семафора больше 0), то поток "получает" разрешение, и значение `counter` уменьшается на 1. Если разрешений нет (т.е. `counter` равен 0), поток блокируется и ждет, пока какое-то разрешение не освободится.
    
- **Освобождение разрешения (`release()`)**: Когда поток завершает работу с ресурсом, он вызывает метод `release()`, чтобы вернуть разрешение семафору. Это увеличивает значение `counter` на 1 и, возможно, разблокирует один из потоков, который ждал разрешения.
    

### Важные моменты:

1. **Управление доступом**: Семафор не связан напрямую с конкретными потоками, но он управляет их доступом к определенному ресурсу. Можно сказать, что семафор — это своего рода "контролер", который регулирует количество потоков, работающих с ресурсом.
    
2. **Синхронизация**: Семафор синхронизирует потоки, заставляя их ждать, если ресурсы заняты, и предоставляя доступ, как только ресурсы освобождаются. Это предотвращает конкуренцию между потоками за ресурсы и предотвращает ситуацию, когда слишком много потоков пытаются одновременно получить доступ к ресурсу.
### Методы

==acquire()== - метод acquire() предназначен для попытки получить разрешение от Semaphore - a.
Метод acquire() заблокирует этот поток, пока ресурс не будет доступен для нас. После доступности, мы получаем разрешение использовать этот общий ресурс, и counter Semaphore-a уменьшается на 1

==release()== - этот метод говорит о том что мы мы освобождаем разрешения Semaphore-a, тем самым увеличивается counter у Semaphore-a на 1. release() всегда нужно использовать в блоке finally 
### Пример
##### У нас 2 телефонные будки, но 5 человек. По этому только 2 человека, могут получить доступ к будкам
```java
public class SemaphoreExample {  
    public static void main(String[] args) {  
        Semaphore callBox = new Semaphore(2);  
        new Person("Zaur", callBox);  
        new Person("Zhenya", callBox);  
        new Person("Victor", callBox);  
        new Person("Elena", callBox);  
        new Person("Oleg", callBox);  
    }  
}  
  
class Person extends Thread {  
    String name;  
    private Semaphore callBox;  
  
    public Person (String name, Semaphore callBox) {  
        this.name = name;  
        this.callBox = callBox;  
        this.start();  
    }  
  
    @Override  
    public void run() {  
        try {  
            System.out.println(name + " ждет...");  
            callBox.acquire();  
            System.out.println(name + " пользуется телефоном");  
            sleep(2000);  
            System.out.println(name + " завершил(а) звонок");  
        } catch (InterruptedException e) {  
            throw new RuntimeException(e);  
        } finally {  
            callBox.release();  
        }  
    }  
}
```

### Еще один пример с парковочными местами 
[Пример](https://habr.com/ru/articles/277669/)
### Заключение:

Семафор — это мощный инструмент для синхронизации потоков в Java. Он управляет количеством потоков, которые могут одновременно получить доступ к общему ресурсу, предотвращая проблемы, связанные с параллельным доступом.



