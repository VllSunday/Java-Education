---
создал заметку: 2024-07-22
---
Анонимные классы могут использоваться практически во всех ситуациях когда используются Local inner classes.

Но программисты используют Анонимные классы на много чаще чем Local inner classes 



- Anonymous класс не имеет имени
- Anonymous класс - это «объявление» класса и одновременное создание объекта
- В анонимных классах невозможно написать конструктор - потому что для написания конструктора необходимо имя. А анонимный класс не имеет имени.
- Анонимный класс может обращаться даже к private элементам внешнего класса
- Lambda expresstion - это краткая форма для написания анонимных классов


Пример: 

**Интерфейс MathOperation**:
```java 
interface MathOperation {
    int doOperation(int a, int b);
}
```

Это объявление интерфейса `MathOperation`. Интерфейс - это контракт, который определяет метод, который должен быть реализован классами, которые его реализуют. В данном случае, интерфейс определяет один метод `doOperation`, который принимает два целых числа и возвращает целое число.

Класс Main:
```java
public class Main {
    public static void main(String[] args) {
        MathOperation m = new MathOperation() {
            @Override
            public int doOperation(int a, int b) {
                return a + b;
            }
        };

        System.out.println(m.doOperation(5, 8));
    }
}

```

Это основной класс, который содержит метод `main`, точку входа для выполнения программы.

**Анонимный класс**:
```java
MathOperation m = new MathOperation() {
    @Override
    public int doOperation(int a, int b) {
        return a + b;
    }
};

```
Здесь мы создаем объект типа `MathOperation` с именем `m`. Вместо того, чтобы создавать отдельный класс, который реализует `MathOperation`, мы создаем **анонимный класс**. Анонимный класс - это класс без имени, который реализует интерфейс `MathOperation` на месте.

В теле анонимного класса мы переопределяем метод `doOperation`, чтобы он возвращал сумму двух чисел `a` и `b`.

Переопределение метода:
```java
@Override
public int doOperation(int a, int b) {
    return a + b;
}

```

**Вызов метода**:
```java
System.out.println(m.doOperation(5, 8));
```

Здесь мы вызываем метод `doOperation` на объекте `m` с аргументами `5` и `8`. Поскольку метод возвращает сумму двух чисел, результат будет `13`.

Таким образом, весь процесс выглядит следующим образом:

1. Объявляется интерфейс `MathOperation` с методом `doOperation`.
2. В методе `main` создается объект анонимного класса, который реализует `MathOperation` и переопределяет метод `doOperation` для выполнения сложения двух чисел.
3. Затем метод `doOperation` вызывается с аргументами `5` и `8`, и результат (`13`) выводится на экран.



Анонимный класс может обращаться даже к private элементам внешнего класса

```java 
public class Main {  
  
    private int x = 5;  
    public static void main(String[] args) {  
            Math m = new Math() {  
                @Override  
                public int doOperation(int a, int b){  
                    Main main = new Main();  
                    return a + b + main.x;  
                }  
            };  
  
        System.out.println(m.doOperation(5 , 8));  
    }  
}  
  
  
interface Math {  
    int doOperation(int a, int b);  
}
```
Что бы получить доступ к переменной(даже private) внешнего класса, нужно создать объект этого класса.


### Объявление и создание анонимного класса

Когда вы объявляете анонимный класс, вы одновременно объявляете новый класс и создаете его экземпляр. Например:
```java
MathOperation m = new MathOperation() {
    @Override
    public int doOperation(int a, int b) {
        return a + b;
    }
};

```
### Как это работает

1. **Объявление и создание**:
    
    - В этом месте кода вы создаете новый класс, который не имеет имени (анонимный класс).
    - Этот класс реализует интерфейс `MathOperation`.
    - Вы также создаете единственный экземпляр этого класса и присваиваете его переменной `m`.
2. **Компиляция**:
    
    - Во время компиляции компилятор Java создает отдельный файл класса для анонимного класса.
    - Имя этого класса генерируется компилятором и обычно выглядит как `Main$1.class`, где `Main` — имя внешнего класса, а `1` — порядковый номер анонимного класса в этом файле.

### Жизненный цикл и хранение

- **Жизненный цикл**:
    
    - Экземпляр анонимного класса существует столько, сколько существует ссылка на него.
    - Если ссылка (`m`) выходит за пределы области видимости или установлена в `null`, объект становится доступным для сборщика мусора (garbage collector).
    - Однако класс, сгенерированный компилятором, будет загружен в память до завершения выполнения программы или до тех пор, пока класс загрузчика не будет выгружен.
- **Хранение**:
    
    - Анонимный класс хранится в скомпилированном виде как отдельный `.class` файл.
    - Он загружается в память JVM при создании экземпляра анонимного класса.

### Пример с комментариями

Вот пример с комментариями для иллюстрации:
```java
public class Main {
    public static void main(String[] args) {
        // Объявление и создание анонимного класса
        MathOperation m = new MathOperation() {
            // Переопределение метода интерфейса
            @Override
            public int doOperation(int a, int b) {
                return a + b; // Реализация метода
            }
        };

        // Вызов метода на объекте анонимного класса
        System.out.println(m.doOperation(5, 8)); // Выводит 13
    }
}

// Интерфейс, который реализует анонимный класс
interface MathOperation {
    int doOperation(int a, int b);
}

```

### Особенности анонимных классов

1. **Без имени**:
    
    - Анонимные классы не имеют имени и могут быть созданы только в момент их объявления.
2. **Использование**:
    
    - Анонимные классы часто используются для создания одноразовых объектов, таких как реализации интерфейсов, обработчики событий, потоки и т.д.
3. **Ограничения**:
    
    - Анонимные классы не могут иметь конструкторов, но они могут использовать блоки инициализации для выполнения кода при создании экземпляра.
    - Анонимные классы имеют доступ к переменным внешнего класса, включая переменные метода, если они объявлены как `final` (или эффективно `final` в случае JDK 8 и новее).

Пример использования переменных
```java
public class Main {
    public static void main(String[] args) {
        final int baseValue = 10; // Должно быть final или эффективно final

        MathOperation m = new MathOperation() {
            @Override
            public int doOperation(int a, int b) {
                return a + b + baseValue; // Использование переменной внешнего метода
            }
        };

        System.out.println(m.doOperation(5, 8)); // Выводит 23
    }
}

interface MathOperation {
    int doOperation(int a, int b);
}

```

Таким образом, анонимные классы обеспечивают гибкий и лаконичный способ создания одноразовых реализаций интерфейсов или классов в Java.